!function(){"use strict";angular.module("app.user").service("msidUserService",["$log","$injector","constants",function(e,t,r){const n=r.USER_SERVICE_TYPE.MSID;var o=void 0;const i="email openid profile user.read",s="https://graph.microsoft.com/v1.0/me/",c=new URL("https://login.microsoftonline.com/common/oauth2/").toString(),a=new URL("https://login.live.com/oauth20_authorize.srf").toString(),u=new URL("nativeclient",c).toString(),l=new URL("v2.0/logoutsession",c).toString(),f=new URL("v2.0/authorize",c).toString(),m=(()=>{var e=new URL(f);return e.search=p({prompt:"select_account"}),e.toString()})();function h(){return o||(o=t.get("userService")),o}function p(e){const t={client_id:"1a20851a-696e-4c7e-96f4-c282dfe48872",response_type:"id_token token",redirect_uri:u,scope:i,response_mode:"fragment"};return new URLSearchParams(Object.assign({},t,e)).toString()}async function d(){var e={method:"GET",url:s,headers:{"X-UserType":n}},t={};try{t=function(e){for(const t in e)e.hasOwnProperty(t)&&t.match(/^@odata/i)&&delete e[t];return e}(await h().httpRequest(e))}catch(e){return Promise.reject("msidUser.fetchUserInfo failed: %s",e)}return t}return{type:n,getConfig:function(){return{loginUrl:m,logoutUrl:l,aadPhotoUrl:r.O365CONFIG.PHOTO_URL,msaPhotoUrl:r.MSACONFIG.PHOTO_URL,userInfoUrl:s,documentsUrl:"https://graph.microsoft.com/v1.0/me/drive/recent"}},getResourceForEndpoint:function(t){if(!t)return i;const r={"https://graph.microsoft.com":{"/v1.0/me/":i,"/v1.0/me/drive/recent":"Files.ReadWrite.All"},"https://nleditor.osi.office.net":{"/NlEditor/":"https://nleditor.osi.office.net/NlEditor/instrumentation.write"},"https://consumer.suite.office.com":{"api/licensing/licensingdata":"https://consumer.suite.office.com/entitlements.read"},"https://webshell.suite.office.com":{"/api/shell/NewTab?culture=en-US":"https://webshell.suite.office.com/.default"}};try{const e=new URL(t);if(!r.hasOwnProperty(e.origin))return i;const n=r[e.origin],o=e.pathname;return n[Object.keys(n).reduce((e,t)=>o.startsWith(t)&&t.length>e.length?t:e)]}catch(t){return e.warning("msidUser.Service threw an exception: "+t),i}},lookupUserInfo:async function(e){const t=[d()];return(await Promise.all(t)).reduce((e,t)=>Object.assign(e,t))},requestAccessToken:async function(t,r,o){var i={scope:t,response_type:"token"};r&&r.email&&(i.login_hint=r.email);var s=p(i),c=new URL(o?a:f);c.search=s.toString();var u=await h().navigateToAuthEndpoint(c.href,n,!0);if(!u||!u.access_token){const r=u&&u.error,n=u&&u.error_description;return e.info(`failed to get token from iframe for resource ${t}, error: ${r}, description: ${n}`),Promise.reject("unable to retrieve result from "+c.href)}return u}}}])}();