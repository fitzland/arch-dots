!function(){"use strict";angular.module("app.editor",[]).controller("EditorController",["$scope","$log","constants","storage","userService","localize","editorUtils","languageUtils",function(e,t,r,i,n,o,a,d){var l=this,s=Object.freeze({undefined:0,enabled:1,disabled:2});function g(){if(l.isLoggedIn){var e=l.upsellFeatureEnabled&&l.editorIsUpsellUser?"EditorRefinementsGoPremiumTooltip":"EditorRefinementsTooltip";l.refinementsTooltipText=o.getLocalizedString(e)}else l.refinementsTooltipText=o.getLocalizedString("ebx_RefinementTooltip")}function u(e){"Enter"===e.key&&(l.editorSpellingToggle=!l.editorSpellingToggle,l.onEditorSpellingChange())}function c(e){"Enter"===e.key&&(l.editorGrammarToggle=!l.editorGrammarToggle,l.onEditorGrammarChange())}function E(e){"Enter"===e.key&&(l.editorAutocorrectToggle=!l.editorAutocorrectToggle,l.onEditorAutocorrectChange())}function b(e){"Enter"===e.key&&(l.editorRefinementsToggle=!l.editorRefinementsToggle,l.onEditorRefinementsChange())}function m(e){l.currentTabUrl=e.url,l.currentHostName=e.hostname,l.editorDisableShow=!1,l.editorEnableShow=!1,l.editorSiteBlockedShow=!1,l.currentHostName?(l.editorSiteBlockedShow=a.siteIsBlocked(l.currentTabUrl),l.editorIsBlockedLabel=a.getFormattedLocalizedString("EditorIsBlockedOnThisSiteLabel",l.currentHostName),l.editorSiteBlockedShow?l.storage.get(["websitesWithNativeIntegration"]).then((function(e){var t=a.readSettingValueOrUndefined(e,"websitesWithNativeIntegration");a.siteHasNativeIntegration(l.currentTabUrl,t)&&(l.editorIsBlockedLabel=a.getFormattedLocalizedString("EditorNativeSupportOnThisSiteLabel",l.currentHostName))})):l.storage.get(["userExcludedUrls","disabledWebSites"]).then((function(e){var t=l.currentHostName;l.userExcludedUrls=a.readSettingValueOrUndefined(e,"userExcludedUrls"),l.disabledWebSites=a.readSettingValueOrUndefined(e,"disabledWebSites"),l.editorDisableLabel=a.getFormattedLocalizedString("DisableEditorOnThisSiteLabel",t),l.editorEnableLabel=a.getFormattedLocalizedString("EnableEditorOnThisSiteLabel",t),l.editorIsDisabledLabel=a.getFormattedLocalizedString("EditorIsDisabledOnThisSiteLabel",t);var r=a.isHostNameExcluded(t,l.userExcludedUrls);a.isUrlExcluded(l.currentTabUrl,l.disabledWebSites)?(l.editorSiteBlockedShow=!0,l.editorDisableShow=!1,l.editorEnableShow=!1):(l.editorSiteBlockedShow=!1,l.editorDisableShow=!r,l.editorEnableShow=r),l.animationsEnabled=!0}))):l.animationsEnabled=!0}function S(){l.editorGrammarToggle=l.editorGrammarEnabled&&l.isLoggedIn}function f(){l.editorRefinementsToggle=l.editorRefinementsEnabled&&l.editorIsPremiumUser&&l.isLoggedIn}function U(){l.editorAutocorrectToggle=l.editorAutocorrectEnabled&&l.editorIsPremiumUser&&l.isLoggedIn}function h(){t.trackEvent("EditorUserInteraction",{name:"SpellingChange"}),a.writeEditorSettingValue("enableSpelling",l.editorSpellingToggle)}function v(){t.trackEvent("EditorUserInteraction",{name:"GrammarChange"}),a.writeEditorSettingValue("enableGrammar",l.editorGrammarToggle)}function T(){t.trackEvent("EditorUserInteraction",{name:"AutocorrectChange"}),a.writeEditorSettingValue("enableAutocorrect",l.editorAutocorrectToggle)}function L(){t.trackEvent("EditorUserInteraction",{name:"RefinementsChange"}),a.writeEditorSettingValue("enableRefinements",l.editorRefinementsToggle)}function p(){t.trackEvent("EditorUserInteraction",{name:"TurnOnClick"}),a.writeEditorSettingValue("enableEditor",!0),l.editorEnabled=!0}function I(){t.trackEvent("EditorUserInteraction",{name:"SettingsClick"}),a.openOptionsPage()}function k(e){var t=document.getElementById(e),r=0;if(t){var i=()=>{t.offsetParent?t.focus():r<10&&(r+=1,window.setTimeout(i,100))};window.setTimeout(i,0)}}function w(){t.trackEvent("EditorUserInteraction",{name:"DisableClick"});var e=a.getHostnameOnlyUrl(l.currentTabUrl);e&&(l.userExcludedUrls.push(e),a.writeEditorSettingValue("userExcludedUrls",l.userExcludedUrls),l.editorDisableShow=!1,l.editorEnableShow=!0,k("editor-enable-button"))}function C(){t.trackEvent("EditorUserInteraction",{name:"EnableClick"}),l.userExcludedUrls=l.userExcludedUrls.filter((function(e){return a.getUrlInfo(e).hostname!==l.currentHostName})),a.writeEditorSettingValue("userExcludedUrls",l.userExcludedUrls),l.editorDisableShow=!0,l.editorEnableShow=!1,k("editor-disable-button")}function O(){t.trackEvent("EditorUserInteraction",{name:"GoPremiumClick"}),Utilities.navigateToUrlWithNewTab(l.constants.LINKS.EDITOR_GO_PREMIUM_URL,!0)}l.onLoad=function(){t.debug("Loading EditorController"),l.storage.get(["editorClientState","enableEditor","enableSpelling","enableGrammar","enableRefinements","enableAutocorrect","proofingLanguages"]).then((function(e){var t=a.readSettingValueOrUndefined(e,"editorClientState");void 0!==t&&(l.editorAvailable=t===s.enabled);var r=a.readSettingValueOrUndefined(e,"enableEditor");void 0!==r&&(l.editorEnabled=r);var i=a.readSettingValueOrUndefined(e,"enableSpelling");void 0!==i&&(l.editorSpellingToggle=i);var n=a.readSettingValueOrUndefined(e,"enableGrammar");void 0!==n&&(l.editorGrammarEnabled=n,S());var o=a.readSettingValueOrUndefined(e,"enableRefinements");void 0!==o&&(l.editorRefinementsEnabled=o,f());var g=a.readSettingValueOrUndefined(e,"enableAutocorrect");void 0!==g&&(l.editorAutocorrectEnabled=g,U());var u=a.readSettingValueOrUndefined(e,"proofingLanguages");if(void 0!==u){l.proofingLanguages=[];for(var c=0;c<u.length;c+=1){var E=u[c],b=d.getLanguageName(E),m=void 0!==b?b:E,h=a.getFormattedLocalizedString("EditorProofingLanguageAriaLabel",m);l.proofingLanguages.push({name:m,ariaLabel:h})}}})),a.getCurrentTabHostName().then(m),l.userService.isLoggedIn().then((function(e){l.isLoggedIn=e,U(),S(),f(),g()})),l.userService.isUpsellFeatureEnabled().then((function(e){l.upsellFeatureEnabled=e,g()})),l.userService.isMultiLangFeatureEnabled().then((function(e){l.isMultiLangFeatureEnabled=e})),l.userService.isUpsellUser().then((function(e){l.editorIsUpsellUser=e,g()})),l.userService.isPremiumUser().then((function(e){l.editorIsPremiumUser=e,f()})),l.userService.isAutocorrectEnabled().then((function(e){l.isAutocorrectFeatureEnabled=e}))},l.constants=r,l.storage=i,l.userService=n,l.localize=o,l.animationsEnabled=!1,l.editorIsBlockedLabel="",l.editorAvailable=!1,l.editorDisableShow=!1,l.editorEnableShow=!1,l.editorIsUpsellUser=!1,l.upsellFeatureEnabled=!1,l.isMultiLangFeatureEnabled=!1,l.editorSiteBlockedShow=!1,l.editorIsPremiumUser=!1,l.isLoggedIn=!1,l.isAutocorrectFeatureEnabled=!1,l.editorRefinementsEnabled=!1,l.editorGrammarEnabled=!1,l.editorAutocorrectEnabled=!1,l.editorEnabled=!0,l.editorSpellingToggle=!0,l.editorGrammarToggle=!0,l.editorRefinementsToggle=!0,l.editorAutocorrectToggle=!0,l.proofingLanguages=[],g(),l.grammarTooltipText=o.getLocalizedString("ebx_signIntoEditorBody"),l.onEditorTurnOnClick=p,l.onEditorSettingsClick=I,l.onEditorDisableClick=w,l.onEditorEnableClick=C,l.onEditorGoPremiumClick=O,l.onEditorSpellingChange=h,l.onEditorGrammarChange=v,l.onEditorAutocorrectChange=T,l.onEditorRefinementsChange=L,l.onEditorSpellingKeyPress=u,l.onEditorGrammarKeyPress=c,l.onEditorAutocorrectKeyPress=E,l.onEditorRefinementsKeyPress=b}])}();